---
interface Command {
  command: string;
  description: string;
  output: { text: string; highlight?: boolean; success?: boolean }[];
}

const commands: Command[] = [
  {
    command: 'gh wt run example -- "task fmt"',
    description: 'Run a command in a worktree',
    output: [
      { text: 'Running in worktree: task fmt', highlight: true },
      { text: '0 issues.', success: true }
    ]
  },
  {
    command: 'gh wt add example',
    description: 'Create a worktree from a local branch',
    output: [
      { text: "Preparing worktree (new branch 'example')", highlight: true },
      { text: "HEAD is now at 3cf4e6b ci: deny bash permission in opencode workflows (#25)" },
      { text: 'Location: /home/wsl/github/worktree/output/example' },
      { text: '✓ Worktree created successfully!', success: true }
    ]
  },
  {
    command: 'gh wt rm example',
    description: 'Remove a worktree and its branch',
    output: [
      { text: 'Removing worktree output/example...', highlight: true },
      { text: 'Worktree: ~/github/worktree/output/example' },
      { text: 'Branch: example' },
      { text: 'Deleted branch example (was 3cf4e6b).' },
      { text: '✓ Worktree removed successfully!', success: true }
    ]
  },
  {
    command: 'gh wt add https://github.com/ffalor/gh-wt/issues/26',
    description: 'Create a worktree from a GitHub issue',
    output: [
      { text: 'Fetching Issue info...', highlight: true },
      { text: 'Creating worktree for Issue #26: basic `github.io` documentation page' },
      { text: "Preparing worktree (new branch 'issue_26')" },
      { text: "HEAD is now at 3cf4e6b ci: deny bash permission in opencode workflows (#25)" },
      { text: 'Location: /home/wsl/github/worktree/gh-wt/issue_26' },
      { text: '✓ Worktree created successfully!', success: true }
    ]
  },
  {
    command: 'gh wt add https://github.com/ffalor/gh-wt/pull/24',
    description: 'Create a worktree from a GitHub pull request',
    output: [
      { text: 'Creating worktree for PR #24: ci: add opencode review workflow', highlight: true },
      { text: 'Fetching PR #24...' },
      { text: 'From https://github.com/ffalor/gh-wt' },
      { text: ' * branch            refs/pull/24/head -> FETCH_HEAD' },
      { text: "Preparing worktree (new branch 'oc-workflows')" },
      { text: "HEAD is now at 0e5176c ci: add opencode review workflow" },
      { text: 'Location: /home/wsl/github/worktree/gh-wt/pr_24' },
      { text: '✓ Worktree created successfully!', success: true }
    ]
  }
];
---

<div class="terminal-hero">
  <div class="command-label">
    <span class="prompt">$</span>
    <span class="current-command" id="hero-command">{commands[0].command}</span>
  </div>
  
  <p class="command-description" id="hero-description">{commands[0].description}</p>
  
  <div class="cli-window">
    <div class="terminal-header-bar">
      <div class="terminal-buttons">
        <span class="terminal-btn close"></span>
        <span class="terminal-btn minimize"></span>
        <span class="terminal-btn maximize"></span>
      </div>
      <div class="terminal-title">bash — gh-wt</div>
      <div class="terminal-controls">
        <button id="carousel-control" class="control-btn" aria-label="Pause animation">
          <svg id="pause-icon" viewBox="0 0 24 24" width="18" height="18">
            <rect x="6" y="4" width="4" height="16" fill="currentColor"/>
            <rect x="14" y="4" width="4" height="16" fill="currentColor"/>
          </svg>
          <svg id="play-icon" class="hidden" viewBox="0 0 24 24" width="18" height="18">
            <path d="M8 5.14v14l11-7-11-7z" fill="currentColor"/>
          </svg>
        </button>
      </div>
    </div>
    
    <div class="terminal-content">
      <div class="output-panel" id="hero-output">
        <span class="typing-line">
          <span class="prompt">$</span>
          <span class="type-text" id="type-text">{commands[0].command}</span><span class="cursor"></span>
        </span>
        <div class="output-content" id="output-content">
        </div>
        <div class="final-prompt-line" id="final-prompt">
          <span class="prompt">$</span><span class="cursor"></span>
        </div>
      </div>
    </div>
  </div>
</div>

<script define:vars={{ commands }}>
  const heroCommand = document.getElementById('hero-command');
  const heroDescription = document.getElementById('hero-description');
  const typeText = document.getElementById('type-text');
  const outputContent = document.getElementById('output-content');
  const finalPrompt = document.getElementById('final-prompt');
  const carouselControl = document.getElementById('carousel-control');
  const pauseIcon = document.getElementById('pause-icon');
  const playIcon = document.getElementById('play-icon');
  const typingLine = document.querySelector('.typing-line');
  const typingCursor = typingLine?.querySelector('.cursor');
  
  let currentIndex = 0;
  let isPaused = false;
  let carouselTimeout = null;
  
  // Show cursor on typing line
  function showTypingCursor() {
    if (typingCursor) {
      typingCursor.style.display = 'inline-block';
    }
  }
  
  // Hide cursor on typing line
  function hideTypingCursor() {
    if (typingCursor) {
      typingCursor.style.display = 'none';
    }
  }
  
  // Type the initial command
  async function typeCommand(text, element) {
    element.textContent = '';
    showTypingCursor();
    for (let i = 0; i < text.length; i++) {
      element.textContent += text[i];
      await new Promise(r => setTimeout(r, 40));
    }
  }
  
  // Show output with stagger effect
  async function showOutput(lines) {
    outputContent.innerHTML = '';
    hideTypingCursor();
    
    for (const line of lines) {
      const lineEl = document.createElement('div');
      lineEl.className = 'output-line';
      
      if (line.success) {
        lineEl.classList.add('success');
      }
      
      if (line.highlight) {
        // Split by space to find highlighted words
        const parts = line.text.split(' ');
        for (let i = 0; i < parts.length; i++) {
          if (i > 0) lineEl.appendChild(document.createTextNode(' '));
          const span = document.createElement('span');
          span.textContent = parts[i];
          if (parts[i].includes('pr_') || parts[i].includes('issue_')) {
            span.className = 'highlight-cyan';
          }
          lineEl.appendChild(span);
        }
      } else {
        lineEl.textContent = line.text;
      }
      
      lineEl.classList.add('fade-in');
      outputContent.appendChild(lineEl);
      await new Promise(r => setTimeout(r, 150));
    }
    
    // Show final prompt with cursor after all output
    showFinalPrompt();
  }
  
  // Show final prompt line with blinking cursor
  function showFinalPrompt() {
    finalPrompt.classList.add('visible');
  }
  
  // Hide final prompt line
  function hideFinalPrompt() {
    finalPrompt.classList.remove('visible');
  }
  
  // Clear output
  function clearOutput() {
    outputContent.innerHTML = '';
    hideFinalPrompt();
  }
  
  // Cycle to next command
  async function nextCommand() {
    if (isPaused) return;
    
    currentIndex = (currentIndex + 1) % commands.length;
    const cmd = commands[currentIndex];
    
    // Clear and type new command
    typeText.textContent = '';
    heroCommand.textContent = cmd.command;
    heroDescription.textContent = cmd.description;
    
    clearOutput();
    await typeCommand(cmd.command, typeText);
    await new Promise(r => setTimeout(r, 300));
    await showOutput(cmd.output);
    
    // Schedule next command
    carouselTimeout = setTimeout(nextCommand, 5000);
  }
  
  // Toggle pause/play
  function togglePause() {
    isPaused = !isPaused;
    pauseIcon.classList.toggle('hidden', isPaused);
    playIcon.classList.toggle('hidden', !isPaused);
    
    if (!isPaused) {
      nextCommand();
    } else {
      clearTimeout(carouselTimeout);
    }
  }
  
  carouselControl.addEventListener('click', togglePause);
  
  // Start the carousel after initial delay
  setTimeout(async () => {
    await typeCommand(commands[0].command, typeText);
    await new Promise(r => setTimeout(r, 400));
    await showOutput(commands[0].output);
    
    carouselTimeout = setTimeout(nextCommand, 5000);
  }, 800);
</script>

<style>
  .terminal-hero {
    width: 100%;
    max-width: 720px;
    margin: 0 auto;
  }
  
  .command-label {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
    font-family: var(--font-mono);
    font-size: 1.1rem;
  }
  
  .command-label .prompt {
    color: var(--color-cyan);
    text-shadow: 0 0 10px var(--color-cyan);
    font-weight: 700;
  }
  
  .current-command {
    color: var(--text-primary);
    background: var(--bg-tertiary);
    padding: 0.25rem 0.75rem;
    border-radius: 4px;
    border: 1px solid var(--border-color);
  }
  
  .command-description {
    text-align: center;
    color: var(--text-secondary);
    font-size: 0.95rem;
    margin-bottom: 1.5rem;
    min-height: 1.5rem;
  }
  
  .cli-window {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    overflow: hidden;
    position: relative;
    box-shadow: 
      0 0 0 1px rgba(0, 255, 249, 0.05),
      0 20px 50px rgba(0, 0, 0, 0.5);
  }
  
  .cli-window::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, 
      var(--color-cyan) 0%, 
      var(--color-magenta) 50%, 
      var(--color-amber) 100%
    );
    opacity: 0.8;
  }
  
  .terminal-header-bar {
    display: flex;
    align-items: center;
    padding: 0.75rem 1rem;
    background: var(--bg-tertiary);
    border-bottom: 1px solid var(--border-color);
    gap: 1rem;
  }
  
  .terminal-buttons {
    display: flex;
    gap: 0.5rem;
  }
  
  .terminal-btn {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    position: relative;
  }
  
  .terminal-btn::after {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 50%;
    opacity: 0.4;
  }
  
  .terminal-btn.close {
    background: #ff5f56;
    box-shadow: 0 0 8px rgba(255, 95, 86, 0.5);
  }
  
  .terminal-btn.minimize {
    background: #ffbd2e;
    box-shadow: 0 0 8px rgba(255, 189, 46, 0.5);
  }
  
  .terminal-btn.maximize {
    background: #27ca40;
    box-shadow: 0 0 8px rgba(39, 202, 64, 0.5);
  }
  
  .terminal-title {
    flex: 1;
    text-align: center;
    font-family: var(--font-mono);
    font-size: 0.75rem;
    color: var(--text-muted);
    letter-spacing: 0.05em;
  }
  
  .terminal-controls {
    display: flex;
    align-items: center;
  }
  
  .control-btn {
    background: none;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    padding: 0.25rem;
    border-radius: 4px;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .control-btn:hover {
    color: var(--color-cyan);
    background: var(--bg-elevated);
  }
  
  .hidden {
    display: none !important;
  }
  
  .terminal-content {
    padding: 1.25rem 1.5rem;
    min-height: 280px;
    font-family: var(--font-mono);
    font-size: 0.85rem;
    line-height: 1.6;
  }
  
  .typing-line {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-primary);
  }
  
  .typing-line .prompt {
    color: var(--color-cyan);
    text-shadow: 0 0 8px var(--color-cyan);
    font-weight: 700;
  }
  
  .typing-line .cursor {
    display: none;
  }
  
  .cursor {
    display: inline-block;
    width: 8px;
    height: 1.1em;
    background: var(--color-cyan);
    animation: blink 1s step-end infinite;
    vertical-align: text-bottom;
    margin-left: 2px;
    box-shadow: 0 0 8px var(--color-cyan);
  }
  
  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
  }
  
  .output-content {
    margin-top: 0.75rem;
    padding-left: 1rem;
    border-left: 2px solid var(--border-color);
  }
  
  .output-line {
    display: block;
    color: var(--text-secondary);
    margin-bottom: 0.25rem;
  }
  
  .output-line.success {
    color: var(--color-green);
    text-shadow: 0 0 10px rgba(0, 255, 136, 0.4);
    margin-top: 0.5rem;
  }
  
  .highlight {
    color: var(--text-primary);
  }
  
  .highlight-cyan {
    color: var(--color-cyan);
    text-shadow: 0 0 8px rgba(0, 255, 249, 0.4);
  }
  
  .final-prompt-line {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 0.5rem;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .final-prompt-line.visible {
    opacity: 1;
  }
  
  .final-prompt-line .prompt {
    color: var(--color-cyan);
    text-shadow: 0 0 8px var(--color-cyan);
    font-weight: 700;
  }
  
  :global(.output-content .fade-in) {
    animation: fadeIn 0.3s ease forwards;
    opacity: 0;
  }
  
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateX(-8px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
</style>
