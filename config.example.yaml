worktree_dir: "~/github/worktree"

actions:
  - name: tmux
    cmds:
      - tmux new-session -d -s "{{.BranchName}}" -c "{{.WorktreePath}}"
      - tmux send-keys -t "{{.BranchName}}":0 "git status" C-m
      - tmux split-window -h -t "{{.BranchName}}":0 -c "{{.WorktreePath}}"
      - tmux send-keys -t "{{.BranchName}}":0.1 "nvim ." C-m
      - tmux select-pane -t "{{.BranchName}}":0.0
      - tmux attach -t "{{.BranchName}}"

  - name: claude
    dir: "{{.WorktreePath}}"
    cmds:
      - claude -p "{{.CLI_ARGS}}"

  - name: dev_bootstrap
    cmds:
      - git status
      - |
        if [ -f package.json ]; then
          if [ -f pnpm-lock.yaml ] && command -v pnpm >/dev/null 2>&1; then
            pnpm install
          elif [ -f yarn.lock ] && command -v yarn >/dev/null 2>&1; then
            yarn install
          elif [ -f package-lock.json ] && command -v npm >/dev/null 2>&1; then
            npm ci
          elif command -v npm >/dev/null 2>&1; then
            npm install
          else
            echo "No supported Node package manager found (pnpm/yarn/npm)."
          fi
        else
          echo "No package.json found; skipping Node dependency install."
        fi
      - |
        if [ -f package.json ]; then
          if command -v npm >/dev/null 2>&1; then
            npm run lint --if-present
            npm run typecheck --if-present
            npm run test --if-present
          fi
        fi
